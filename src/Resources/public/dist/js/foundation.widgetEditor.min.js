"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function e(i,n){_classCallCheck(this,e),this.$element=i,this.options=t.extend({},e.defaults,i.data(),options),this._init(),Foundation.registerPlugin(this,"WidgetEditor")}return _createClass(e,[{key:"_init",value:function(){if(this.widgetId=this.options.widgetId,this.$toolbar=this.$element.find("> [data-widget-toolbar]"),this.$container=this.$element.parents(".widgetcontainer"),t("#content-widgets-reveal").length>0?this.$contentWidgetsReveal=t("#content-widgets-reveal"):(this.$contentWidgetsReveal=t('<div id="content-widgets-reveal" class="reveal content-widgets-reveal" data-reveal>'),t("body").append(this.$contentWidgetsReveal),this.$contentWidgetsReveal.foundation()),this.options.layoutWidget){this.$row=this.$element.find("> .row"),this.$columns=this.$row.find("> .column, > .columns");var e=Foundation.GetYoDigits(8,"widget");this.$row.attr("data-equalizer",e),this.$columns.attr("data-equalizer-watch",e),this.$eq=new Foundation.Equalizer(this.$row,{equalizeByRow:!0})}this._events()}},{key:"_events",value:function(){this.$toolbar.on("click","[data-delete-widget]",this._deleteWidget.bind(this)),this.$toolbar.on("click","[data-edit-widget]",this._editWidget.bind(this)),this.$toolbar.on("click","[data-toggle-hidden]",this._toggleHidden.bind(this))}},{key:"_revealEvents",value:function(){this.$contentWidgetsReveal.off("submit","form").on("submit","form",this._submitWidgetForm.bind(this))}},{key:"_deleteWidget",value:function(t){t.preventDefault(),this._ajaxGet("/widget/"+this.widgetId+"/delete")}},{key:"_editWidget",value:function(t){t.preventDefault(),this._ajaxGet("/widget/"+this.widgetId+"/edit")}},{key:"_toggleHidden",value:function(t){t.preventDefault(),this._ajaxGet("/widget/"+this.widgetId+"/toggle-hidden")}},{key:"_submitWidgetForm",value:function(e){e.preventDefault();var i=t(e.currentTarget);this._ajaxFormSubmit(i)}},{key:"_ajaxGet",value:function(e,i){var n=this;void 0===i&&(i={}),t.ajax({type:"get",url:""+this.options.rootPath+e,dataType:"json",data:i,success:function(t){n._ajaxCallback(t)}})}},{key:"_ajaxFormSubmit",value:function(e){var i=this;console.log(e.serializeArray()),t.ajax({type:"post",url:e.attr("action"),dataType:"json",data:e.serializeArray(),success:function(t){console.log(t),i._ajaxCallback(t)}})}},{key:"_ajaxCallback",value:function(e){switch(e.action){case"open-reveal":this._openReveal(e.html);break;case"update-widget":this.$contentWidgetsReveal.foundation("close"),this.$element.find("[data-tooltip]").foundation("destroy");var i=t(e.html);this.$element.replaceWith(i),i.foundation();break;case"remove-widget":this.$contentWidgetsReveal.foundation("close"),this.$element.find("[data-tooltip]").foundation("destroy"),this.$element.remove();break;case"close-reveal":default:this.$contentWidgetsReveal.foundation("close")}e.messages.length>0}},{key:"_openReveal",value:function(t){this.$contentWidgetsReveal.html(t),this.$contentWidgetsReveal.find("> *").foundation(),this.$contentWidgetsReveal.foundation("open"),this._revealEvents()}},{key:"destroy",value:function(){Foundation.unregisterPlugin(this)}}],[{key:"defaults",get:function(){return{}}}]),e}();Foundation.plugin(e,"WidgetEditor")}(jQuery);