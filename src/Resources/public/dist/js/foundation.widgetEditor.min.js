"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(e){var t=function(){function t(i,n){_classCallCheck(this,t),this.$element=i,this.options=e.extend({},t.defaults,i.data(),n),this._init(),Foundation.registerPlugin(this,"WidgetEditor")}return _createClass(t,[{key:"_init",value:function(){if(this.widgetId=this.options.widgetId,this.$toolbar=this.$element.find("> [data-widget-toolbar]"),this.$container=this.$element.parents(".widgetcontainer"),e("#content-widgets-reveal").length>0?this.$contentWidgetsReveal=e("#content-widgets-reveal"):(this.$contentWidgetsReveal=e('<div id="content-widgets-reveal" class="reveal content-widgets-reveal" data-reveal>'),e("body").append(this.$contentWidgetsReveal),this.$contentWidgetsReveal.foundation()),this.options.layoutWidget){this.$row=this.$element.find("> .row"),this.$columns=this.$row.find("> .column, > .columns");var t=Foundation.GetYoDigits(8,"widget");this.$row.attr("data-equalizer",t),this.$columns.attr("data-equalizer-watch",t),this.$eq=new Foundation.Equalizer(this.$row,{equalizeByRow:!0})}this._events()}},{key:"_events",value:function(){this.$toolbar.on("click","[data-delete-widget]",this._deleteWidget.bind(this)),this.$toolbar.on("click","[data-edit-widget]",this._editWidget.bind(this)),this.$toolbar.on("click","[data-toggle-hidden]",this._toggleHidden.bind(this))}},{key:"_revealEvents",value:function(){this.$contentWidgetsReveal.off("submit","form").on("submit","form",this._submitWidgetForm.bind(this))}},{key:"_deleteWidget",value:function(e){e.preventDefault(),console.log("_deleteWidget"),this._ajaxGet("/widget/"+this.widgetId+"/delete")}},{key:"_editWidget",value:function(e){e.preventDefault(),console.log("_editWidget"),this._ajaxGet("/widget/"+this.widgetId+"/edit")}},{key:"_toggleHidden",value:function(e){e.preventDefault(),console.log("_toggleHidden"),this._ajaxGet("/widget/"+this.widgetId+"/toggle-hidden")}},{key:"_submitWidgetForm",value:function(t){t.preventDefault();var i=e(t.currentTarget);this._ajaxFormSubmit(i)}},{key:"_ajaxGet",value:function(t,i){var n=this;void 0===i&&(i={}),e.ajax({type:"get",url:""+this.options.rootPath+t,dataType:"json",data:i,success:function(e){n._ajaxCallback(e)}})}},{key:"_ajaxFormSubmit",value:function(t){var i=this;console.log(t.serializeArray()),e.ajax({type:"post",url:t.attr("action"),dataType:"json",data:t.serializeArray(),success:function(e){console.log(e),i._ajaxCallback(e)}})}},{key:"_ajaxCallback",value:function(t){switch(t.action){case"open-reveal":this._openReveal(t.html);break;case"update-widget":this.$contentWidgetsReveal.foundation("close"),this.$element.find("[data-tooltip]").foundation("destroy");var i=e(t.html);this.$element.replaceWith(i),i.foundation();break;case"remove-widget":this.$contentWidgetsReveal.foundation("close"),this.$element.find("[data-tooltip]").foundation("destroy"),this.$element.remove();break;case"close-reveal":default:this.$contentWidgetsReveal.foundation("close")}t.messages.length>0}},{key:"_openReveal",value:function(e){this.$contentWidgetsReveal.html(e),this.$contentWidgetsReveal.find("> *").foundation(),this.$contentWidgetsReveal.foundation("open"),this._revealEvents()}},{key:"destroy",value:function(){Foundation.unregisterPlugin(this)}}],[{key:"defaults",get:function(){return{}}}]),t}();Foundation.plugin(t,"WidgetEditor")}(jQuery);